import json
import os

def load_config():
    """Loads configuration from the config.json file."""
    try:
        with open('config.json', 'r') as file:
            return json.load(file)
    except FileNotFoundError:
        print("Error: config.json file not found.")
        exit(1)
    except json.JSONDecodeError as e:
        print(f"Error: JSON decode error: {e}")
        exit(1)

def scan_files_for_malware(directory, malware_signatures):
    """Scans files in the specified directory for malware signatures."""
    detected_malware = []

    for root, _, files in os.walk(directory):
        for file in files:
            file_path = os.path.join(root, file)
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    content = f.read()
                    for signature in malware_signatures:
                        if signature in content:
                            detected_malware.append((file_path, signature))
            except (FileNotFoundError, PermissionError) as e:
                print(f"Error reading file {file_path}: {e}")
            except UnicodeDecodeError:
                print(f"Error decoding file {file_path}. Consider using a different encoding.")
    
    return detected_malware

def main():
    config = load_config()
    malware_signatures = config.get('malware_signatures', [])
    scan_directory = config.get('scan_directory', '.')

    if not malware_signatures:
        print("No malware signatures found in config.json.")
        exit(1)

    detected_malware = scan_files_for_malware(scan_directory, malware_signatures)

    if detected_malware:
        print("Malware detected:")
        for file_path, signature in detected_malware:
            print(f"File: {file_path}, Signature: {signature}")
    else:
        print("No malware detected.")

if __name__ == "__main__":
    main()
